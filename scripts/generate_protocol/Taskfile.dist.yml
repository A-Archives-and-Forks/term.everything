# yaml-language-server: $schema=https://taskfile.dev/schema.json

version: "3"

includes:
  bun-install-types: ../BunInstallTypes.yml


tasks:
  build:
    deps:
      - bun-install-types:run
    internal: true
    sources:
      - scripts/generate_protocol/protocols/*.xml
      - scripts/generate_protocol/src/*.ts
    generates:
      - "{{.PROTOCOLs_OUT_DIR}}/wayland.xml.ts"
    cmds:
      - mkdir -p {{.PROTOCOLs_OUT_DIR}}
      - bun run scripts/generate_protocol/src/main.ts
    silent: true
    env:
      OUT_DIR: "{{.PROTOCOLs_OUT_DIR}}"
    desc: Build the .ts files from wayland.xml files

  clean:
    cmds:
      - rm -rf {{.PROTOCOLs_OUT_DIR}}
