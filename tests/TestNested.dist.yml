# yaml-language-server: $schema=https://taskfile.dev/schema.json

version: "3"

 # How to use:
# Do this in order in four terminals
# IN term 1:
#   `task`
# In term 2:
#   `task test:nested:xwayland`
# In term 3:
#   `task test:nested:as-nested-client`
# in term 4:
#  the window you want to run
#  for example alacritty
#  WAYLAND_DISPLAY=wayland-3 alacritty
# You should see your pgrogarm running in the
# compositor running in the compositor (nested)
tasks:

  xwayland:
    cmds:
      # YOu would think you could put the env variables
      # in env: but it doesn't work
      # so some env go here
      - WAYLAND_DISPLAY=wayland-2 Xwayland :2
    env:
      WAYLAND_DISPLAY: wayland-2

  as-nested-client:
    cmds:
      # YOu would think you could put the env variables
      # in env: but it doesn't work
      # so some env go here
      - WAYLAND_DISPLAY=wayland-2 DISPLAY=:2 bun run src/index.ts
    silent: true
    env:
      WAYLAND_DEBUG: 1
      WAYLAND_DISPLAY_NAME: wayland-3
      DEBUG_IS_CLIENT_WINDOW: 1
      WAYLAND_DEBUG_HIDE_SURFACE_AND_BUFFER_MESSAGES: 1
      # KEY_MAP_PATH: "{{.KEYMAP_PATH}}"